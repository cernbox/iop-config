---
  apiVersion: helm.fluxcd.io/v1
  kind: HelmRelease
  metadata:
    name: cern-iop-staging
    namespace: staging
    annotations:
      fluxcd.io/automated: "true"
  spec:
    releaseName: cern-iop-staging
    chart:
      # TODO(SamuAlfageme):
      # Replace with HelmRelease.sepc.{repository, name, version}
      git: https://github.com/sciencemesh/charts.git
      path: iop
      ref: init_flux
    values:
      revad:
        configFiles:
          # Users https://raw.githubusercontent.com/cs3org/reva/b208f4df729be30a8b03fbbe7f9848e614e2015f/examples/ocm-partners/users-cern.json
          users.json: |
            [
              {
                "id": {
                  "opaque_id": "ishank1234",
                  "idp": "https://cern.ch"
                },
                "username": "ishank",
                "secret": "ishankpass",
                "mail": "ishank@cern.ch",
                "display_name": "Ishank Arora",
                "groups": ["sailing-lovers", "violin-haters", "physics-lovers"]
              },
              {
                "id": {
                  "opaque_id": "hugo5678",
                  "idp": "https://cern.ch"
                },
                "username": "hugo",
                "secret": "hugopass",
                "mail": "hugo@cern.ch",
                "display_name": "Hugo Gonzalez Labrador",
                "groups": ["radium-lovers", "polonium-lovers", "physics-lovers"]
              },
              {
                "id": {
                  "opaque_id": "samuel9876",
                  "idp": "https://cern.ch"
                },
                "username": "samuel",
                "secret": "samuelpass",
                "mail": "samuel@cern.ch",
                "display_name": "Samuel Alfageme Sainz",
                "groups": ["quantum-lovers", "philosophy-haters", "physics-lovers"]
              }
            ]
          # Providers https://raw.githubusercontent.com/cs3org/reva/b208f4df729be30a8b03fbbe7f9848e614e2015f/examples/ocm-partners/providers.demo.json
          providers.json: |
            [
              {
                "domain": "https://cern.ch",
                "api_version": "0.0.1",
                "api_endpoint": "https://sciencemesh.cernbox.cern.ch/ocm/",
                "webdav_endpoint": "https://sciencemesh.cernbox.cern.ch/webdav/"
              },
              {
                "domain": "https://cesnet.cz",
                "api_version": "0.0.1",
                "api_endpoint": "https://sciencemesh.cesnet.cz/ocm/",
                "webdav_endpoint": "https://sciencemesh.cesnet.cz/webdav/"
              },
              {
                "domain": "https://uni-muenster.de",
                "api_version": "0.0.1",
                "api_endpoint": "https://sciencemesh-test.uni-muenster.de/ocm/",
                "webdav_endpoint": "https://sciencemesh-test.uni-muenster.de/webdav/"
              },
              {
                "domain": "https://cubbit.io",
                "api_version": "0.0.1",
                "api_endpoint": "https://ocm.cubbit.io/ocm/",
                "webdav_endpoint": "https://ocm.cubbit.io/webdav/"
              },
              {
                "domain": "https://ailleron.com",
                "api_version": "0.0.1",
                "api_endpoint": "http://cs3mesh.softwaremind.com:19000/ocm/",
                "webdav_endpoint": "http://cs3mesh.softwaremind.com:19000/webdav/"
              },
              {
                "domain": "https://surfsara.nl",
                "api_version": "0.0.1",
                "api_endpoint": "https://app.cs3mesh-iop.k8s.surfsara.nl/ocm/",
                "webdav_endpoint": "https://app.cs3mesh-iop.k8s.surfsara.nl/webdav/"
              }
            ]
      ingress:
        enabled: true
        services:
          grpc:
            hostname: sciencemesh.cernbox.cern.ch
            path: /
            annotations:
              kubernetes.io/ingress.class: nginx
              nginx.ingress.kubernetes.io/ssl-redirect: "true"
              nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
            tls:
              - secretName: cernbox-wildcard
                hosts:
                  - sciencemesh.cernbox.cern.ch
          http:
            hostname: sciencemesh.cernbox.cern.ch
            path: /iop(/|$)(.*)
            annotations:
              kubernetes.io/ingress.class: nginx
              nginx.ingress.kubernetes.io/ssl-redirect: "true"
              nginx.ingress.kubernetes.io/rewrite-target: /$2
            tls:
              - secretName: cernbox-wildcard
                hosts:
                  - sciencemesh.cernbox.cern.ch

